{% extends "base.html" %}

{% block title %}AI Memory - Spiritual Battlegrounds{% endblock %}

{% block content %}
<div class="hero">
    <h1>ðŸ§  AI MEMORY</h1>
    <p>Server-wide message logging and AI context database</p>
</div>

<div class="card" style="margin-bottom: 2rem;">
    <h2 style="font-size: 1.8rem; margin-bottom: 1.5rem; color: #8a2be2;">Memory Statistics</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; text-align: center;">
        <div>
            <div style="font-size: 3rem; color: #8a2be2;" id="total-messages">0</div>
            <div style="color: #aaa;">Total Messages Logged</div>
        </div>
        <div>
            <div style="font-size: 3rem; color: #da70d6;">50</div>
            <div style="color: #aaa;">Messages in Context</div>
        </div>
        <div>
            <div style="font-size: 3rem; color: #8a2be2;">30 days</div>
            <div style="color: #aaa;">Retention Period</div>
        </div>
    </div>
</div>

<div class="card">
    <h2 style="font-size: 1.8rem; margin-bottom: 1.5rem; color: #da70d6;">Recent Messages</h2>
    <div id="messages-list" style="max-height: 500px; overflow-y: auto;"></div>
</div>
{% endblock %}

{% block extra_js %}
async function loadMemory() {
    const res = await fetch('/memory_stats');
    const data = await res.json();
    
    document.getElementById('total-messages').textContent = data.total_messages;
    
    const list = document.getElementById('messages-list');
    list.innerHTML = '';
    
    if (data.recent_messages && data.recent_messages.length > 0) {
        data.recent_messages.forEach(msg => {
            const div = document.createElement('div');
            div.style.cssText = 'padding: 1rem; margin-bottom: 0.5rem; background: rgba(138,43,226,0.1); border-radius: 8px; border-left: 3px solid #8a2be2;';
            div.innerHTML = `
                <div style="font-weight: 600; color: #8a2be2; margin-bottom: 0.5rem;">${msg.username}</div>
                <div style="color: #e0e0e0;">${msg.content}</div>
                <div style="color: #888; font-size: 0.85rem; margin-top: 0.5rem;">${new Date(msg.timestamp).toLocaleString()}</div>
            `;
            list.appendChild(div);
        });
    } else {
        list.innerHTML = '<p style="color: #aaa; text-align: center; padding: 2rem;">No messages logged yet</p>';
    }
}

loadMemory();
setInterval(loadMemory, 10000);
{% endblock %}
